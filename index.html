<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sade Akış - Akıllı Sinyal Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Newsreader:opsz,wght@6..72,400;6..72,500;6..72,700;6..72,800&display=swap');

        :root {
            --bg-paper: #f9f7f2;
            --ink: #1a1a1a;
            --accent: #991b1b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-paper);
            color: var(--ink);
            -webkit-font-smoothing: antialiased;
        }

        .serif {
            font-family: 'Newsreader', serif;
        }

        .archive-card {
            background: white;
            border: 1px solid var(--ink);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .archive-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px -8px rgba(0, 0, 0, 0.1);
        }

        .list-view-item {
            border-bottom: 1px solid #e5e4df;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            padding: 0.6rem 0;
            gap: 0.75rem;
        }

        .list-view-item:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .btn-serious {
            border: 1px solid var(--ink);
            padding: 0.4rem 0.8rem;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-serious:hover:not(:disabled) {
            background: var(--ink);
            color: white;
        }

        .btn-serious:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .feed-filter.active {
            border-bottom: 2px solid var(--ink);
            color: var(--ink);
            font-weight: 600;
        }

        .img-placeholder {
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .placeholder-initial {
            font-family: 'Newsreader', serif;
            font-size: 5rem;
            font-weight: 800;
            color: var(--ink);
            opacity: 0.05;
        }

        /* Status Badge for Cache */
        .cache-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            padding: 2px 6px;
            font-size: 9px;
            font-weight: bold;
            border: 1px solid #eee;
            border-radius: 4px;
            color: #666;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 4px;
        }
    </style>
</head>

<body class="min-h-screen">

    <!-- Ana Yapıda Değişiklik: flex flex-col ve min-h-screen eklendi, böylece footer en alta itilir -->
    <div class="max-w-6xl mx-auto px-6 pt-8 pb-16 min-h-screen flex flex-col">
        <header class="mb-6 border-b border-black pb-4">
            <div
                class="flex flex-wrap justify-between items-center mb-4 text-[9px] uppercase font-bold tracking-widest text-gray-500">
                <div class="flex items-center gap-4">
                    <span class="text-black"><span id="displayCity">İSTANBUL</span>, <span
                            id="currentDate"></span></span>
                    <div id="economyBar" class="flex gap-3 border-l border-gray-200 pl-4">
                        <span id="usdRate">USD --.--</span>
                        <span id="eurRate">EUR --.--</span>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="refreshBtn"
                        class="p-1.5 border border-gray-200 rounded hover:bg-white active:bg-gray-100 transition-colors"
                        title="Zorla Yenile (Önbelleği Temizle)"><i data-lucide="rotate-cw" class="w-3 h-3"
                            id="refreshIcon"></i></button>
                    <button id="manageFeedsBtn" class="p-1.5 border border-gray-200 rounded hover:bg-white"><i
                            data-lucide="settings" class="w-3 h-3"></i></button>
                </div>
            </div>
            <div class="flex flex-col md:flex-row md:items-end justify-between">
                <div>
                    <h1 class="serif text-5xl font-bold tracking-tighter text-black">RSS</h1>
                    <p class="text-[10px] uppercase tracking-[0.2em] font-medium mt-1 text-gray-400 italic">Sinyal ve
                        Takip Paneli</p>
                </div>
            </div>
        </header>

        <div class="flex items-center justify-between mb-6 pb-2">
            <nav id="feedFilters"
                class="flex items-center gap-6 overflow-x-auto no-scrollbar text-[9px] uppercase tracking-widest text-gray-400 font-bold">
            </nav>
            <div class="flex items-center gap-3 border-l border-gray-200 pl-4 text-gray-400">
                <button id="viewCardBtn" title="Kart"><i data-lucide="layout-grid" class="w-3.5 h-3.5"></i></button>
                <button id="viewListBtn" title="Liste"><i data-lucide="list" class="w-3.5 h-3.5"></i></button>
            </div>
        </div>

        <!-- flex-grow eklendi: İçerik az olsa bile bu alan genişleyerek pagination'ı aşağı iter -->
        <main id="newsGrid" class="flex-grow min-h-[400px]">
        </main>

        <!-- Pagination için ayrı bir container oluşturuldu -->
        <div id="paginationContainer" class="mt-auto"></div>
    </div>

    <!-- Kaynak Ekleme Modalı -->
    <div id="modal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center z-[100] p-4">
        <div class="w-full max-w-md bg-[#f9f7f2] border border-black p-8 shadow-2xl">
            <div class="flex justify-between items-start mb-6 border-b border-black pb-4">
                <h2 id="modalTitle" class="serif text-2xl font-bold uppercase">Yeni Kaynak</h2>
                <button id="closeModal"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>

            <div class="space-y-5">
                <div>
                    <label class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-1 block">Hızlı Seçim
                        (Opsiyonel)</label>
                    <select id="presetSelector"
                        class="w-full bg-white border border-black/10 px-3 py-2 text-xs outline-none focus:border-black appearance-none cursor-pointer">
                        <option value="">Katalogdan Seç...</option>
                    </select>
                </div>
                <div>
                    <label class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-1 block">Kaynak
                        Türü</label>
                    <select id="feedTypeSelector"
                        class="w-full bg-white border border-black/10 px-3 py-2 text-xs outline-none focus:border-black appearance-none cursor-pointer">
                        <option value="rss">Standart RSS / Podcast Linki</option>
                        <option value="youtube">YouTube Kanalı (ID veya Link)</option>
                        <option value="auto">Web Sitesi (Otomatik Bul)</option>
                    </select>
                </div>

                <div>
                    <label id="urlInputLabel"
                        class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-1 block">RSS Linki
                        Yapıştırın</label>
                    <div class="flex gap-2">
                        <input type="text" id="feedUrlInput" placeholder="https://..."
                            class="flex-1 bg-white border border-black/10 px-3 py-2 text-xs outline-none focus:border-black">
                        <button id="fetchUrlBtn"
                            class="bg-black text-white px-3 py-2 hover:bg-gray-800 transition-colors flex items-center gap-2">
                            <i data-lucide="search" class="w-3.5 h-3.5"></i>
                            <span class="text-[10px] font-bold">GETİR</span>
                        </button>
                    </div>
                    <div id="urlStatusContainer" class="mt-2 hidden">
                        <p id="urlStatus" class="text-[8px] font-bold uppercase"></p>
                    </div>
                    <p id="inputHelper" class="text-[8px] mt-2 italic text-gray-400 uppercase tracking-tighter">Bazı
                        haber siteleri proxy servislerini engeller; bu durumda manuel isim girerek devam edebilirsiniz.
                    </p>
                </div>

                <div id="detectedInfo"
                    class="hidden space-y-4 animate-in fade-in slide-in-from-top-2 duration-300 border-t border-black/5 pt-4">
                    <div>
                        <label
                            class="text-[9px] font-bold uppercase tracking-widest text-gray-400 mb-1 block">Görüntülenecek
                            Başlık</label>
                        <input type="text" id="feedNameInput" placeholder="Örn: RSS Adı"
                            class="w-full bg-white border border-black/10 px-3 py-2 text-xs outline-none focus:border-black">
                    </div>
                    <button id="saveFeed" class="btn-serious bg-black text-white w-full py-3 mt-4">KAYNAĞI PANELİNE
                        EKLE</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ayarlar Modalı -->
    <div id="manageModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center z-50 p-4">
        <div class="w-full max-w-2xl bg-[#f9f7f2] border border-black shadow-2xl flex flex-col max-h-[90vh]">
            <div class="p-8 border-b border-black/10 flex justify-between items-center">
                <h2 class="serif text-3xl font-bold uppercase">Ayarlar</h2>
                <button id="closeManageModal"
                    class="p-2 border border-black/10 rounded-full hover:bg-black hover:text-white transition-all"><i
                        data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="p-8 overflow-y-auto no-scrollbar flex-grow space-y-6">
                <div>
                    <label class="text-[9px] font-bold uppercase text-gray-400 block mb-1">Şehir</label>
                    <input type="text" id="cityInput"
                        class="w-full bg-transparent border-b border-black/10 py-2 text-lg font-bold uppercase serif outline-none focus:border-black">
                </div>
                <div>
                    <div class="flex justify-between items-center border-b border-black/10 pb-2 mb-4">
                        <h3 class="text-[10px] font-black uppercase tracking-widest text-gray-400">Takip Edilenler</h3>
                        <button id="addNewFeedFromSettings" class="text-[8px] px-2 py-1 border border-black font-bold">+
                            EKLE</button>
                    </div>
                    <div id="manageListBody" class="divide-y divide-black/5"></div>
                </div>
            </div>
            <div class="p-6 bg-black/[0.02] border-t border-black/10 flex justify-end">
                <button id="globalSaveBtn" class="btn-serious bg-black text-white px-12 py-3">TÜMÜNÜ KAYDET</button>
            </div>
        </div>
    </div>

    <!-- Onay Modalı -->
    <div id="confirmModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center z-[110] p-4">
        <div class="w-full max-w-xs bg-[#f9f7f2] border border-black p-8 shadow-2xl text-center">
            <p class="serif text-xl font-bold mb-6 uppercase tracking-tight">Emin misiniz?</p>
            <div class="flex gap-6 justify-center">
                <button id="cancelDelete"
                    class="text-[9px] font-bold uppercase tracking-[0.2em] opacity-40 hover:opacity-100 transition-opacity">Vazgeç</button>
                <button id="confirmDelete"
                    class="text-[9px] font-bold uppercase tracking-[0.2em] text-red-700 hover:text-red-500 transition-colors">Evet,
                    Sil</button>
            </div>
        </div>
    </div>

    <script>
        const RX_PRESETS = [{ "category": "Bilim", "items": [{ "title": "Arkeofili", "url": "https://arkeofili.com/feed/" }, { "title": "Beyinsizler", "url": "https://beyinsizler.net/feed/" }, { "title": "Bilim Günlüğü", "url": "https://www.bilimgunlugu.com/feed/" }, { "title": "Bilim ve Gelecek", "url": "https://bilimvegelecek.com.tr/index.php/feed/" }, { "title": "Bilimoloji", "url": "https://www.bilimoloji.com/feed/" }, { "title": "Bilimup", "url": "https://www.bilimup.com/rss.xml" }, { "title": "DijitalX", "url": "https://www.dijitalx.com/feed/" }, { "title": "Evrim Ağacı", "url": "https://evrimagaci.org/rss.xml" }, { "title": "Tarihli Bilim", "url": "https://www.tarihlibilim.com/feed/" }, { "title": "Tarihten Yazılar", "url": "https://tarihtenyazilar.com/feed/" }, { "title": "Fizikist", "url": "https://www.fizikist.com/feed" }, { "title": "Gerçek Bilim", "url": "https://www.gercekbilim.com/feed/" }, { "title": "Gelecek Bilimde", "url": "https://gelecekbilimde.net/feed/" }, { "title": "Herkese Bilim Teknoloji", "url": "https://www.herkesebilimteknoloji.com/feed" }, { "title": "Independent Bilim", "url": "https://www.indyturk.com/taxonomy/term/48791/%2A/feed" }, { "title": "Kozmik Anafor", "url": "https://www.kozmikanafor.com/feed/" }, { "title": "Matematiksel", "url": "https://www.matematiksel.org/feed" }, { "title": "Megabayt Bilim", "url": "https://www.megabayt.com/rss/categorynews/bilim" }, { "title": "Moletik", "url": "https://moletik.com/feed/" }, { "title": "Popular Science", "url": "https://popsci.com.tr/feed/" }, { "title": "Sarkaç", "url": "https://sarkac.org/feed/" }, { "title": "Sinirbilim", "url": "https://sinirbilim.org/feed/" }] }, { "category": "Teknoloji", "items": [{ "title": "Beetekno", "url": "https://www.beetekno.com/feed/posts" }, { "title": "Campaign Türkiye", "url": "https://www.campaigntr.com/feed/" }, { "title": "CHIP Online", "url": "https://www.chip.com.tr/rss" }, { "title": "ÇözümPark", "url": "https://www.cozumpark.com/feed/" }, { "title": "Dijitaliyidir", "url": "https://dijitaliyidir.com/feed/" }, { "title": "Donanım Haber", "url": "https://www.donanimhaber.com/rss/tum/" }, { "title": "Donanım Günlüğü", "url": "https://donanimgunlugu.com/feed" }, { "title": "FounderN", "url": "https://foundern.com/feed/" }, { "title": "Hardware Plus", "url": "https://hwp.com.tr/feed" }, { "title": "Investing Teknoloji", "url": "https://tr.investing.com/rss/news_288.rss" }, { "title": "İndir", "url": "https://www.indir.com/haber/feed/" }, { "title": "LOG", "url": "https://www.log.com.tr/feed/" }, { "title": "Megabayt", "url": "https://www.megabayt.com/rss/news" }, { "title": "Megabayt Bilgisayar", "url": "https://www.megabayt.com/rss/categorynews/bilgisayar" }, { "title": "Megabayt Bilim ve Teknoloji", "url": "https://www.megabayt.com/rss/categorynews/bilim-ve-teknoloji" }, { "title": "Megabayt Donanım", "url": "https://www.megabayt.com/rss/categorynews/donanim" }, { "title": "Megabayt Nasıl Yapılır?", "url": "https://www.megabayt.com/rss/categorynews/nasil-yapilir" }, { "title": "Megabayt Siber Güvenlik", "url": "https://www.megabayt.com/rss/categorynews/siber-guvenlik" }, { "title": "Megabayt Sosyal Medya", "url": "https://www.megabayt.com/rss/categorynews/sosyal-medya" }, { "title": "Megabayt Teknoloji", "url": "https://www.megabayt.com/rss/categorynews/teknoloji" }, { "title": "Megabayt Yazılım", "url": "https://www.megabayt.com/rss/categorynews/yazilim" }, { "title": "PC Hocası", "url": "https://pchocasi.com.tr/feed" }, { "title": "Sordum", "url": "https://www.sordum.net/feed/" }, { "title": "Swipeline", "url": "https://swipeline.co/feed/" }, { "title": "Techolay", "url": "https://techolay.net/feed/" }, { "title": "Technopat", "url": "https://www.technopat.net/feed/" }, { "title": "Teknoblog", "url": "https://www.teknoblog.com/feed/" }, { "title": "Teknolojioku", "url": "https://www.teknolojioku.com/export/rss" }, { "title": "TeknoBurada", "url": "https://www.teknoburada.net/feed/" }, { "title": "Tam İndir", "url": "https://feeds.feedburner.com/tamindir/stream" }, { "title": "VoiceTekno", "url": "https://voicetekno.com/feed/" }, { "title": "Webmasto", "url": "https://webmasto.com/feed" }, { "title": "Webrazzi", "url": "https://webrazzi.com/feed" }, { "title": "Webtekno", "url": "https://www.webtekno.com/rss.xml" }] }, { "category": "Eğlence", "items": [{ "title": "22 Dakika", "url": "https://22dakika.org/feed/" }, { "title": "Atarita", "url": "https://www.atarita.com/feed/" }, { "title": "Altyazı", "url": "https://altyazi.net/feed/" }, { "title": "Bağımsız Sinema", "url": "https://www.bagimsizsinema.com/feed" }, { "title": "Beyaz Perde", "url": "https://www.beyazperde.com/rss/haberler.xml" }, { "title": "Bigumigu", "url": "https://bigumigu.com/feed/" }, { "title": "Bilimkurgu Kulübü", "url": "https://www.bilimkurgukulubu.com/feed/" }, { "title": "Fantastik Canavarlar", "url": "https://fantastikcanavarlar.com/feed/" }, { "title": "FRPNET", "url": "https://frpnet.net/feed" }, { "title": "Geekyapar", "url": "https://geekyapar.com/feed/" }, { "title": "IGN Türkiye", "url": "https://tr.ign.com/feed.xml" }, { "title": "Kayıp Rıhtım", "url": "https://kayiprihtim.com/feed/" }, { "title": "Keşif Asya", "url": "https://kesifasya.com/feed/" }, { "title": "ListeList", "url": "https://listelist.com/feed/" }, { "title": "Marjinal Sinema", "url": "https://marjinalsinema.com/feed/" }, { "title": "Merlin'in Kazanı", "url": "https://www.merlininkazani.com/feed/" }, { "title": "Megabayt Dijital Platformlar", "url": "https://www.megabayt.com/rss/categorynews/dijital-platformlar" }, { "title": "Megabayt Dizi-sinema", "url": "https://www.megabayt.com/rss/categorynews/dizi-sinema" }, { "title": "Megabayt Oyun", "url": "https://www.megabayt.com/rss/categorynews/oyun" }, { "title": "Megabayt Sinema", "url": "https://www.megabayt.com/rss/categorynews/sinema" }, { "title": "Megabayt Televizyon", "url": "https://www.megabayt.com/rss/categorynews/televizyon" }, { "title": "Megabayt Youtube", "url": "https://www.megabayt.com/rss/categorynews/youtube" }, { "title": "Mister Noob", "url": "https://www.misternoob.com/feed/" }, { "title": "Mobidictum", "url": "https://mobidictum.com/tr/feed/" }, { "title": "Onedio", "url": "https://onedio.com/Publisher/publisher-daily.rss" }, { "title": "Öteki Sinema", "url": "https://www.otekisinema.com/feed/" }, { "title": "Sofos", "url": "https://blog.sofos.com.tr/feed/" }, { "title": "Sinetopya", "url": "https://sinetopya.com/rss/" }, { "title": "The Geyik", "url": "https://www.thegeyik.com/feed/" }, { "title": "Turkmmo", "url": "https://www.turkmmo.com/feed" }, { "title": "Turuncu Levye", "url": "https://www.turunculevye.com/feed/" }] }, { "category": "Kültür ve Sanat", "items": [{ "title": "10layn", "url": "https://10layn.com/feed/" }, { "title": "Artdog", "url": "https://artdogistanbul.com/feed/" }, { "title": "Artkolik", "url": "https://www.artkolik.net/feed" }, { "title": "Argonotlar", "url": "https://argonotlar.com/feed/" }, { "title": "Arkitera", "url": "https://www.arkitera.com/feed/" }, { "title": "Bant Mag", "url": "https://bantmag.com/feed/" }, { "title": "Cafrande", "url": "https://www.cafrande.org/feed/" }, { "title": "Çekiçle Felsefe", "url": "https://cekiclefelsefe.com/feed/" }, { "title": "Edebi Bülten", "url": "https://edebibulten.com/feed/" }, { "title": "Edebiyat Burada", "url": "https://edebiyatburada.com/feed/" }, { "title": "Edebiyat Haber", "url": "https://www.edebiyathaber.net/feed/" }, { "title": "Fikir Turu", "url": "https://fikirturu.com/feed/" }, { "title": "Kilikya Dergisi", "url": "https://dergipark.org.tr/tr/pub/kilikya/rss/lastissue/tr" }, { "title": "Kitap Haber", "url": "https://www.kitaphaber.com.tr/feed" }, { "title": "Görünüm Dergisi", "url": "https://dergipark.org.tr/tr/pub/gorunum/rss/lastissue/tr" }, { "title": "Gazete Sanat", "url": "https://www.gazetesanat.com/feed" }, { "title": "Hafta", "url": "https://www.hafta.com.tr/rss.xml" }, { "title": "İşin Detayı Kültür Sanat", "url": "https://www.isindetayi.com/rss/kultur-sanat" }, { "title": "Manifold", "url": "https://manifold.press/rss" }, { "title": "Mesail", "url": "https://www.mesail.org/feed/" }, { "title": "Megabayt Kültür Sanat", "url": "https://www.megabayt.com/rss/categorynews/kultur-sanat" }, { "title": "Mitoloji", "url": "https://mitoloji.org.tr/feed/" }, { "title": "Mürekkep Haber", "url": "https://www.murekkephaber.com/rss.xml" }, { "title": "Nouvart", "url": "https://www.nouvart.net/feed/" }, { "title": "Öncül", "url": "https://onculanalitikfelsefe.com/feed/" }, { "title": "Play Tuşu", "url": "https://playtusu.com/feed/" }, { "title": "Rotka", "url": "https://www.rotka.org/feed/" }, { "title": "Sosyal Bilimler", "url": "https://www.sosyalbilimler.org/feed/" }, { "title": "Terrabayt", "url": "https://terrabayt.com/feed" }, { "title": "Vesaire", "url": "https://vesaire.press/feed/" }, { "title": "Yedikıta", "url": "https://yedikita.com.tr/feed/" }] }, { "category": "Spor", "items": [{ "title": "A Spor", "url": "https://www.aspor.com.tr/rss/anasayfa.xml" }, { "title": "AjansSpor", "url": "https://ajansspor.com/rss" }, { "title": "Fotomaç", "url": "https://www.fotomac.com.tr/rss/anasayfa.xml" }, { "title": "Fotomaç Son 24 Saat", "url": "https://www.fotomac.com.tr/rss/son24saat.xml" }, { "title": "Fotomaç Süper Lig", "url": "https://www.fotomac.com.tr/rss/SuperLig.xml" }, { "title": "Fotomaç Beşiktaş", "url": "https://www.fotomac.com.tr/rss/Besiktas.xml" }, { "title": "Fotomaç Fenerbahçe", "url": "https://www.fotomac.com.tr/rss/Fenerbahce.xml" }, { "title": "Fotomaç Galatasaray", "url": "https://www.fotomac.com.tr/rss/Galatasaray.xml" }, { "title": "Fotomaç Trabzonspor", "url": "https://www.fotomac.com.tr/rss/Trabzonspor.xml" }, { "title": "Fotomaç Bursaspor", "url": "https://www.fotomac.com.tr/rss/Bursaspor.xml" }, { "title": "Fotomaç Basketbol", "url": "https://www.fotomac.com.tr/rss/Basketbol.xml" }, { "title": "Fotospor", "url": "https://www.fotospor.com/feed/rss_sondakika.xml" }, { "title": "Megabayt Spor", "url": "https://www.megabayt.com/rss/categorynews/spor" }, { "title": "Kontraspor", "url": "https://kontraspor.com/rss" }, { "title": "NTV Spor Anasayfa", "url": "https://www.ntvspor.net/rss/anasayfa" }, { "title": "NTV Spor Basketbol", "url": "https://www.ntvspor.net/rss/kategori/basketbol" }, { "title": "NTV Spor Diğer Sporlar", "url": "https://www.ntvspor.net/rss/kategori/diger-sporlar" }, { "title": "NTV Spor Dünyadan Futbol", "url": "https://www.ntvspor.net/rss/kategori/dunyadan-futbol" }, { "title": "NTV Spor Futbol", "url": "https://www.ntvspor.net/rss/kategori/futbol" }, { "title": "NTV Spor Motor Sporları", "url": "https://www.ntvspor.net/rss/kategori/motor-sporlari" }, { "title": "NTV Spor Olimpiyat", "url": "https://www.ntvspor.net/rss/kategori/olimpiyat" }, { "title": "NTV Spor Tenis", "url": "https://www.ntvspor.net/rss/kategori/tenis" }, { "title": "NTV Spor Voleybol", "url": "https://www.ntvspor.net/rss/kategori/voleybol" }, { "title": "Sözcü 2024 Paris Olimpiyatları", "url": "https://www.sozcu.com.tr/feeds-rss-category-2024-paris-olimpiyatlari" }, { "title": "Sözcü Basketbol", "url": "https://www.sozcu.com.tr/feeds-rss-category-basketbol" }, { "title": "Sözcü Diğer Sporlar", "url": "https://www.sozcu.com.tr/feeds-rss-category-diger-sporlar" }, { "title": "Sözcü Dünyadan Futbol", "url": "https://www.sozcu.com.tr/feeds-rss-category-dunyadan-spor" }, { "title": "Sözcü Futbol", "url": "https://www.sozcu.com.tr/feeds-rss-category-futbol" }, { "title": "Sözcü Spor", "url": "https://www.sozcu.com.tr/feeds-rss-category-spor" }, { "title": "Sözcü Voleybol", "url": "https://www.sozcu.com.tr/feeds-rss-category-voleybol" }] }, { "category": "Gündem", "items": [{ "title": "10Haber", "url": "https://10haber.net/feed/" }, { "title": "ABC Haber", "url": "https://abcgazetesi.com.tr/rss" }, { "title": "A Haber", "url": "https://www.ahaber.com.tr/rss/gundem.xml" }, { "title": "Açık Gazete", "url": "https://www.acikgazete.com/feed/" }, { "title": "Akşam", "url": "https://www.aksam.com.tr/rss/rss.asp" }, { "title": "Al Ain Türkçe", "url": "https://tr.al-ain.com/feed" }, { "title": "Anadolu Ajansı", "url": "https://www.aa.com.tr/tr/rss/default?cat=guncel" }, { "title": "Agos", "url": "https://www.agos.com.tr/rss" }, { "title": "Artı Gerçek", "url": "https://artigercek.com/service/rss.php" }, { "title": "Aydınlık", "url": "https://www.aydinlik.com.tr/feed" }, { "title": "Aykırı", "url": "https://www.aykiri.com.tr/rss.xml" }, { "title": "Ayandon", "url": "https://www.ayandon.com.tr/rss.xml" }, { "title": "BBC Türkçe", "url": "https://feeds.bbci.co.uk/turkce/rss.xml" }, { "title": "Bengütürk", "url": "https://www.benguturk.com/rss" }, { "title": "Beyaz Gazete", "url": "https://beyazgazete.com/rss/guncel.xml" }, { "title": "BHA", "url": "https://bha.net.tr/rss" }, { "title": "Bianet", "url": "https://bianet.org/biamag.rss" }, { "title": "Bir Gazete", "url": "https://www.birgazete.com/feed" }, { "title": "BirGün", "url": "https://www.birgun.net/rss/home" }, { "title": "CNN Türk", "url": "https://www.cnnturk.com/feed/rss/all/news" }, { "title": "Cumhuriyet", "url": "https://www.cumhuriyet.com.tr/rss/son_dakika.xml" }, { "title": "CGTN Türk", "url": "https://www.cgtnturk.com/rss" }, { "title": "Demokrat Haber", "url": "https://www.demokrathaber.org/rss" }, { "title": "Diken", "url": "https://www.diken.com.tr/feed/" }, { "title": "Diriliş Postası", "url": "https://www.dirilispostasi.com/rss" }, { "title": "Diyanet Haber", "url": "https://www.diyanethaber.com.tr/rss" }, { "title": "Dijital Gaste", "url": "https://www.dijitalgaste.com/rss" }, { "title": "dikGAZETE", "url": "https://www.dikgazete.com/xml/rss.xml" }, { "title": "Doğru Haber", "url": "https://dogruhaber.com.tr/rss" }, { "title": "Dokuz8 Haber", "url": "https://www.dokuz8haber.net/rss" }, { "title": "Dünya", "url": "https://www.dunya.com/rss?dunya" }, { "title": "DW Haber", "url": "https://rss.dw.com/rdf/rss-tur-all" }, { "title": "En Politik", "url": "https://www.enpolitik.com/rss.xml" }, { "title": "Elips Haber", "url": "https://www.elipshaber.com/rss" }, { "title": "Ekonomim", "url": "https://www.ekonomim.com/export/rss" }, { "title": "Ekol TV", "url": "https://www.ekoltv.com.tr/service/rss.php" }, { "title": "En Son Haber", "url": "https://www.ensonhaber.com/rss/ensonhaber.xml" }, { "title": "Evrensel", "url": "https://www.evrensel.net/rss/haber.xml" }, { "title": "F5 Haber", "url": "https://www.f5haber.com/export/rss" }, { "title": "Fayn", "url": "https://www.fayn.press/rss/" }, { "title": "Gazete Duvar", "url": "https://www.gazeteduvar.com.tr/export/rss" }, { "title": "Gazete.net", "url": "https://gazete.net/rss" }, { "title": "Gazete Pencere", "url": "https://www.gazetepencere.com/service/rss.php" }, { "title": "Gerçek Gündem", "url": "https://www.gercekgundem.com/rss" }, { "title": "GZT", "url": "https://www.gzt.com/rss" }, { "title": "Haber 3", "url": "https://www.haber3.com/rss" }, { "title": "Haber 7", "url": "https://i12.haber7.net/sondakika/newsstand/latest.xml" }, { "title": "Haber", "url": "https://www.haber.com/rss" }, { "title": "Haberler", "url": "https://rss.haberler.com/RssNew.aspx" }, { "title": "Haber Global", "url": "https://haberglobal.com.tr/rss" }, { "title": "Habertürk", "url": "https://www.haberturk.com/rss" }, { "title": "Haberet", "url": "https://www.haberet.com/export/rss" }, { "title": "Halk TV", "url": "https://halktv.com.tr/service/rss.php" }, { "title": "Haberport", "url": "https://www.haberport.com/rss/latest-posts" }, { "title": "Haberiniz", "url": "https://haberiniz.com.tr/feed/" }, { "title": "Hürriyet", "url": "https://www.hurriyet.com.tr/rss/anasayfa" }, { "title": "İklim Haber", "url": "https://www.iklimhaber.org/feed/" }, { "title": "Independent", "url": "https://www.indyturk.com/rss.xml" }, { "title": "İnternet Haber", "url": "https://www.internethaber.com/rss" }, { "title": "İşin Detayı", "url": "https://www.isindetayi.com/rss/gundem" }, { "title": "İşçi Haber", "url": "https://www.iscihaber.net/rss/news" }, { "title": "İlke TV", "url": "https://ilketv.com.tr/feed/" }, { "title": "Journo", "url": "https://journo.com.tr/feed" }, { "title": "Karar", "url": "https://www.karar.com/service/rss.php" }, { "title": "Kamudan Haber", "url": "https://www.kamudanhaber.net/rss" }, { "title": "Kısa Dalga", "url": "https://kisadalga.net/service/rss.php" }, { "title": "Korkusuz", "url": "https://www.korkusuz.com.tr/feeds/rss" }, { "title": "KRT TV", "url": "https://www.krttv.com.tr/rss" }, { "title": "Medya Gazete", "url": "https://www.medyagazete.com/rss/genel-0" }, { "title": "Megabayt Gündem", "url": "https://www.megabayt.com/rss/categorynews/gundem" }, { "title": "Milli Gazete", "url": "https://www.milligazete.com.tr/rss" }, { "title": "Mynet", "url": "https://www.mynet.com/haber/rss/sondakika" }, { "title": "Muhalif", "url": "https://www.muhalif.com.tr/rss/genel-0" }, { "title": "NewsLab Turkey", "url": "https://www.newslabturkey.org/feed/" }, { "title": "NTV", "url": "https://www.ntv.com.tr/gundem.rss" }, { "title": "OdaTV", "url": "https://www.odatv.com/rss.xml" }, { "title": "Radikal", "url": "https://www.radikal.com.tr/feed/" }, { "title": "Sabah", "url": "https://www.sabah.com.tr/rss/gundem.xml" }, { "title": "Serbestiyet", "url": "https://serbestiyet.com/feed/" }, { "title": "Sözcü", "url": "https://www.sozcu.com.tr/feeds-rss-category-sozcu" }, { "title": "Sözcü Astroloji", "url": "https://www.sozcu.com.tr/feeds-rss-category-astroloji" }, { "title": "Sözcü Bilim ve Teknoloji", "url": "https://www.sozcu.com.tr/feeds-rss-category-bilim-teknoloji" }, { "title": "Sözcü Eğitim", "url": "https://www.sozcu.com.tr/feeds-rss-category-egitim" }, { "title": "Sözcü Gündem", "url": "https://www.sozcu.com.tr/feeds-rss-category-gundem" }, { "title": "Sözcü Günün İçinden", "url": "https://www.sozcu.com.tr/feeds-rss-category-gunun-icinden" }, { "title": "Sözcü Hayat", "url": "https://www.sozcu.com.tr/feeds-rss-category-hayat" }, { "title": "Sözcü İlan", "url": "https://www.sozcu.com.tr/feeds-rss-category-ilan" }, { "title": "Sözcü Kültür Sanat", "url": "https://www.sozcu.com.tr/feeds-rss-category-kultur-sanat" }, { "title": "Sözcü Magazin", "url": "https://www.sozcu.com.tr/feeds-rss-category-magazin" }, { "title": "Sözcü Otomotiv", "url": "https://www.sozcu.com.tr/feeds-rss-category-otomotiv" }, { "title": "Sözcü Resmi İlanlar", "url": "https://www.sozcu.com.tr/feeds-rss-category-resmi-ilanlar" }, { "title": "Sözcü Sağlık", "url": "https://www.sozcu.com.tr/feeds-rss-category-saglik" }, { "title": "Sözcü Son Dakika", "url": "https://www.sozcu.com.tr/feeds-son-dakika" }, { "title": "Sözcü Yazarlar", "url": "https://www.sozcu.com.tr/feeds-rss-category-yazar" }, { "title": "Sözcü Yaşam", "url": "https://www.sozcu.com.tr/feeds-rss-category-yasam" }, { "title": "soL Haber", "url": "https://haber.sol.org.tr/rss.xml" }, { "title": "Sputnik", "url": "https://anlatilaninotesi.com.tr/export/rss2/archive/index.xml" }, { "title": "Star", "url": "https://www.star.com.tr/rss/rss.asp" }, { "title": "T24", "url": "https://t24.com.tr/rss" }, { "title": "Teyit", "url": "https://teyit.org/feed?lang=tr" }, { "title": "Tele1", "url": "https://www.tele1.com.tr/rss" }, { "title": "Tele2", "url": "https://www.tele2haber.com/rss" }, { "title": "Timeturk", "url": "https://www.timeturk.com/rss/" }, { "title": "Türkiye Gazetesi", "url": "https://www.turkiyegazetesi.com.tr/feed" }, { "title": "Türkgün", "url": "https://www.turkgun.com/rss/news" }, { "title": "TRT Haber", "url": "https://www.trthaber.com/sondakika.rss" }, { "title": "TGRT Haber", "url": "https://www.tgrthaber.com/rss/manset" }, { "title": "Ulusal Kanal", "url": "https://www.ulusal.com.tr/rss" }, { "title": "Ulusal Post", "url": "https://www.ulusalpost.com/service/rss.php" }, { "title": "Uyan32", "url": "https://www.uyan32.com/rss" }, { "title": "Veryansın TV", "url": "https://www.veryansintv.com/feed" }, { "title": "Yeni Akit", "url": "https://www.yeniakit.com.tr/rss/haber/gundem" }, { "title": "Yeni Asır Gazetesi", "url": "https://www.yeniasir.com.tr/rss/anasayfa.xml" }, { "title": "Yeniçağ Gazetesi", "url": "https://www.yenicaggazetesi.com.tr/service/rss.php" }, { "title": "Yeni Şafak", "url": "https://www.yenisafak.com/rss?xml=gundem" }, { "title": "Yeni Yaşam Gazetesi", "url": "https://yeniyasamgazetesi9.com/feed/" }, { "title": "Yeşil Gazete", "url": "https://yesilgazete.org/feed/" }, { "title": "Yurt Gazetesi", "url": "https://www.yurtgazetesi.com.tr/service/rss.php" }, { "title": "Yurtsever", "url": "https://yurtsever.org.tr/feed" }] }, { "category": "Savunma ve Sanayi", "items": [{ "title": "C4 Defence", "url": "https://www.c4defence.com/feed/" }, { "title": "DefenceTurk", "url": "https://www.defenceturk.net/feed" }, { "title": "Mavi Savunma", "url": "https://mavisavunma.com/feed/" }, { "title": "Sanayi Gazetesi", "url": "https://sanayigazetesi.com.tr/kategori/savunma-haberleri/feed/" }, { "title": "Savunma Sanayi Gazetesi", "url": "https://savunmasanayigazetesi.com.tr/feed/" }, { "title": "SavunmaSanayiST", "url": "https://www.savunmasanayist.com/feed/" }, { "title": "SavunmaTR", "url": "https://www.savunmatr.com/feed/" }] }, { "category": "Ekonomi ve Finans", "items": [{ "title": "Bloomberg HT", "url": "https://www.bloomberght.com/rss" }, { "title": "Bigpara", "url": "https://bigpara.hurriyet.com.tr/rss/" }, { "title": "CNBC-e", "url": "https://www.cnbce.com/rss" }, { "title": "Döviz", "url": "https://www.doviz.com/news/rss" }, { "title": "Ekonomi Gazetesi", "url": "https://www.ekonomigazetesi.com/rss.xml" }, { "title": "Forbes Türkiye", "url": "https://www.forbes.com.tr/rss" }, { "title": "Foreks", "url": "https://www.foreks.com/rss/" }, { "title": "Investing Genel", "url": "https://tr.investing.com/rss/market_overview.rss" }, { "title": "Investing Kripto", "url": "https://tr.investing.com/rss/302.rss" }, { "title": "Investing Döviz", "url": "https://tr.investing.com/rss/forex.rss" }, { "title": "Investing Hisse Senedi", "url": "https://tr.investing.com/rss/stock.rss" }, { "title": "Investing Emtia", "url": "https://tr.investing.com/rss/commodities.rss" }, { "title": "Investing Tahvil", "url": "https://tr.investing.com/rss/bonds.rss" }, { "title": "Investing Haberler", "url": "https://tr.investing.com/rss/news.rss" }, { "title": "Megabayt Ekonomi", "url": "https://www.megabayt.com/rss/categorynews/ekonomi" }, { "title": "Megabayt Kripto Para", "url": "https://www.megabayt.com/rss/categorynews/kripto-para" }, { "title": "Sözcü Borsa", "url": "https://www.sozcu.com.tr/feeds-rss-category-borsa" }, { "title": "Sözcü Ekonomi", "url": "https://www.sozcu.com.tr/feeds-rss-category-ekonomi" }, { "title": "Sözcü Emlak", "url": "https://www.sozcu.com.tr/feeds-rss-category-emlak" }, { "title": "Sözcü Emtia", "url": "https://www.sozcu.com.tr/feeds-rss-category-emtia" }, { "title": "Sözcü Finans", "url": "https://www.sozcu.com.tr/feeds-rss-category-finans" }, { "title": "Sözcü Kripto", "url": "https://www.sozcu.com.tr/feeds-rss-category-kripto" }] }, { "category": "İş Dünyası", "items": [{ "title": "İşin Detayı", "url": "https://www.isindetayi.com/rss" }, { "title": "İşin Detayı Borsa", "url": "https://www.isindetayi.com/rss/borsa" }, { "title": "İşin Detayı Ekonomi", "url": "https://www.isindetayi.com/rss/ekonomi" }, { "title": "İşin Detayı Finans", "url": "https://www.isindetayi.com/rss/finans" }, { "title": "İşin Detayı Gayrimenkul", "url": "https://www.isindetayi.com/rss/gayrimenkul" }, { "title": "İşin Detayı İş Dünyası", "url": "https://www.isindetayi.com/rss/is-dunyasi" }, { "title": "İşin Detayı Lojistik", "url": "https://www.isindetayi.com/rss/lojistik" }, { "title": "İşin Detayı Şirket Haberleri", "url": "https://www.isindetayi.com/rss/sirket-haberleri" }, { "title": "Megabayt Şirket Haberleri", "url": "https://www.megabayt.com/rss/categorynews/sirket-haberleri" }, { "title": "Midas", "url": "https://www.getmidas.com/feed/" }] }, { "category": "Yaşam", "items": [{ "title": "Anne Kaz", "url": "https://www.annekaz.com/feed" }, { "title": "İşin Detayı Gastronomi", "url": "https://www.isindetayi.com/rss/gastronomi" }, { "title": "İşin Detayı Moda", "url": "https://www.isindetayi.com/rss/moda" }, { "title": "İşin Detayı Sağlık", "url": "https://www.isindetayi.com/rss/saglik" }, { "title": "İşin Detayı Turizm", "url": "https://www.isindetayi.com/rss/turizm" }, { "title": "İşin Detayı Yaşam", "url": "https://www.isindetayi.com/rss/yasam" }, { "title": "Istanbul Life", "url": "https://istanbullife.com.tr/feed/" }, { "title": "Live To Bloom", "url": "https://livetobloom.com/feed/" }, { "title": "Martı Dergisi", "url": "https://www.martidergisi.com/feed/" }, { "title": "Megabayt Aksesuar", "url": "https://www.megabayt.com/rss/categorynews/aksesuar" }, { "title": "Megabayt Eğitim", "url": "https://www.megabayt.com/rss/categorynews/egitim" }, { "title": "Megabayt İnceleme", "url": "https://www.megabayt.com/rss/categorynews/inceleme" }, { "title": "Megabayt Magazin", "url": "https://www.megabayt.com/rss/categorynews/magazin" }, { "title": "Megabayt Otomobil", "url": "https://www.megabayt.com/rss/categorynews/otomobil" }, { "title": "Megabayt Popüler Haberler", "url": "https://www.megabayt.com/rss/categorynews/populer-haberler" }, { "title": "Megabayt Sağlık", "url": "https://www.megabayt.com/rss/categorynews/saglik" }, { "title": "Megabayt Yaşam", "url": "https://www.megabayt.com/rss/categorynews/yasam" }, { "title": "Medium Türkçe Yayın", "url": "https://medium.com/feed/t%C3%BCrkiye" }, { "title": "Medium Türkiye Yayını", "url": "https://mediumturkiye.com/feed" }, { "title": "Uplifers", "url": "https://www.uplifers.com/feed/" }, { "title": "PlumeMag", "url": "https://www.plumemag.com/feed/" }] }];
        const STORAGE_KEY = 'rss_reader_v3';
        const SETTINGS_KEY = 'rss_settings_v3';
        const CACHE_PREFIX = 'rss_cache_';
        const CACHE_DURATION = 1000 * 60 * 15; // 15 Minutes Cache

        // Proxy Waterfall Strategy
        // 1. RSS2JSON (Best format, strict limits)
        // 2. AllOrigins (Returns JSON wrapped string)
        // 3. CodeTabs (Returns Raw)
        const PROXIES = [
            { name: 'rss2json', url: u => `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(u)}` },
            { name: 'allorigins', url: u => `https://api.allorigins.win/get?url=${encodeURIComponent(u)}` },
            { name: 'codetabs', url: u => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}` }
        ];

        let feeds = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY)) || { city: 'İSTANBUL' };
        let viewMode = localStorage.getItem('viewMode') || 'card';
        let draftFeeds = [];
        let editingIndex = -1;
        let deleteAction = null;
        let currentItems = [];
        let currentPage = 1;
        const ITEMS_PER_PAGE = 12;

        // UI Elements
        const typeSelector = document.getElementById('feedTypeSelector');
        const urlInputLabel = document.getElementById('urlInputLabel');
        const feedUrlInput = document.getElementById('feedUrlInput');
        const inputHelper = document.getElementById('inputHelper');

        // --- Caching Logic ---
        function getCachedData(url) {
            try {
                const key = CACHE_PREFIX + btoa(url);
                const cached = localStorage.getItem(key);
                if (!cached) return null;
                const { timestamp, data } = JSON.parse(cached);
                if (Date.now() - timestamp < CACHE_DURATION) {
                    return { ...data, _fromCache: true, _timestamp: timestamp };
                }
                return null; // Expired
            } catch (e) { return null; }
        }

        function setCachedData(url, data) {
            try {
                const key = CACHE_PREFIX + btoa(url);
                localStorage.setItem(key, JSON.stringify({ timestamp: Date.now(), data }));
            } catch (e) {
                console.warn('Cache limit reached, clearing old cache');
                Object.keys(localStorage).forEach(k => {
                    if (k.startsWith(CACHE_PREFIX)) localStorage.removeItem(k);
                });
            }
        }

        // --- Fetch & Parser Logic ---
        async function fetchRSSData(url, forceRefresh = false) {
            // 1. Check Cache
            if (!forceRefresh) {
                const cached = getCachedData(url);
                if (cached) return cached;
            }

            // 2. Try Proxies in Order
            let lastError = null;
            for (const proxy of PROXIES) {
                try {
                    const fetchUrl = proxy.url(url);
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000); // 8s timeout

                    const res = await fetch(fetchUrl, { signal: controller.signal });
                    clearTimeout(timeoutId);

                    if (!res.ok) throw new Error(`HTTP ${res.status}`);

                    let result;

                    if (proxy.name === 'rss2json') {
                        const data = await res.json();
                        if (data.status === 'ok') result = data;
                        else throw new Error('RSS2JSON Error');
                    }
                    else if (proxy.name === 'allorigins') {
                        const data = await res.json();
                        result = parseXML(data.contents);
                    }
                    else if (proxy.name === 'codetabs') {
                        const text = await res.text();
                        result = parseXML(text);
                    }

                    if (result && result.items && result.items.length > 0) {
                        setCachedData(url, result);
                        return result;
                    }
                } catch (e) {
                    console.warn(`${proxy.name} failed:`, e);
                    lastError = e;
                    continue; // Try next proxy
                }
            }

            // If we are here, all failed. Try to return STALE cache if exists
            const stale = localStorage.getItem(CACHE_PREFIX + btoa(url));
            if (stale) {
                const parsed = JSON.parse(stale);
                return { ...parsed.data, _fromCache: true, _stale: true };
            }

            throw lastError || new Error("Tüm kaynaklar başarısız oldu.");
        }

        function parseXML(xmlStr) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlStr, "text/xml");

            const getTag = (parent, name) => {
                const el = parent.getElementsByTagName(name)[0] || parent.getElementsByTagName('dc:' + name)[0] || parent.getElementsByTagName('content:' + name)[0];
                return el ? el.textContent : "";
            };

            const items = Array.from(xmlDoc.querySelectorAll("item, entry")).map(node => {
                let link = getTag(node, "link");
                if (!link && node.querySelector("link")) link = node.querySelector("link").getAttribute("href");

                let thumb = "";
                // Try multiple thumbnail strategies
                const mediaContent = node.getElementsByTagName("media:content")[0];
                const enclosure = node.getElementsByTagName("enclosure")[0];
                const mediaThumbnail = node.getElementsByTagName("media:thumbnail")[0] || node.getElementsByTagName("thumbnail")[0];

                if (mediaContent) thumb = mediaContent.getAttribute("url");
                else if (enclosure) thumb = enclosure.getAttribute("url");
                else if (mediaThumbnail) thumb = mediaThumbnail.getAttribute("url");
                else {
                    const desc = getTag(node, "description") || getTag(node, "content");
                    const imgMatch = desc.match(/src="([^"]+)"/);
                    if (imgMatch) thumb = imgMatch[1];
                }

                return {
                    title: getTag(node, "title"),
                    link: link,
                    pubDate: getTag(node, "pubDate") || getTag(node, "published") || getTag(node, "date"),
                    description: (getTag(node, "description") || getTag(node, "summary") || "").replace(/<[^>]*>/g, '').substring(0, 150),
                    thumbnail: thumb
                };
            });

            return {
                status: 'ok',
                feed: {
                    title: getTag(xmlDoc, "title"),
                    image: xmlDoc.querySelector("image > url")?.textContent || ""
                },
                items: items
            };
        }

        // --- App Logic ---

        typeSelector.onchange = () => {
            const val = typeSelector.value;
            if (val === 'rss') {
                urlInputLabel.innerText = "RSS Linki Yapıştırın";
                feedUrlInput.placeholder = "https://haber-sitesi.com/rss";
                inputHelper.innerText = "Haber sitelerinin sonunda genellikle /rss veya /feed bulunur.";
            } else if (val === 'youtube') {
                urlInputLabel.innerText = "YouTube Kanal ID veya Link";
                feedUrlInput.placeholder = "UC-lHJZR3Gqxm24_Vd_AJ5Yw veya Kanal Linki";
                inputHelper.innerText = "Kanal linkini veya sadece 'UC...' ile başlayan ID'yi yapıştırabilirsiniz.";
            } else {
                urlInputLabel.innerText = "Web Sitesi Adresi";
                feedUrlInput.placeholder = "google.com, bbc.com vb.";
                inputHelper.innerText = "Sadece sitenin ana adresini girin, biz RSS kaynağını bulmaya çalışalım.";
            }
        };

        async function smartFetch() {
            const status = document.getElementById('urlStatus');
            const btn = document.getElementById('fetchUrlBtn');
            const type = typeSelector.value;
            if (!feedUrlInput.value) return;

            document.getElementById('urlStatusContainer').classList.remove('hidden');
            status.innerText = "Analiz Ediliyor...";
            status.className = "text-[8px] font-bold uppercase text-gray-500";
            btn.disabled = true;

            let testUrl = feedUrlInput.value.trim();
            if (type === 'youtube' || testUrl.includes('youtube.com') || testUrl.includes('youtu.be')) {
                let channelId = testUrl;
                if (testUrl.includes('channel/')) channelId = testUrl.split('channel/')[1].split('/')[0].split('?')[0];
                else if (testUrl.includes('feeds/videos.xml?channel_id=')) channelId = testUrl.split('channel_id=')[1];

                if (channelId.startsWith('UC')) {
                    testUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${channelId}`;
                    feedUrlInput.value = channelId;
                }
            } else if (type === 'auto' && !testUrl.includes('http')) {
                testUrl = 'https://' + testUrl;
            }

            try {
                // Force refresh when adding new
                const data = await fetchRSSData(testUrl, true);
                status.innerText = "Kaynak Doğrulandı!";
                status.className = "text-[8px] font-bold uppercase text-green-600";
                document.getElementById('feedNameInput').value = data.feed.title;
                document.getElementById('detectedInfo').classList.remove('hidden');
                // Store normalized URL
                if (type === 'auto' && data.feed.link) testUrl = data.feed.link; // Simplified
            } catch (e) {
                status.innerText = "Otomatik doğrulama başarısız. Manuel ekleyebilirsiniz.";
                status.className = "text-[8px] font-bold uppercase text-orange-600";
                document.getElementById('detectedInfo').classList.remove('hidden');
            } finally {
                btn.disabled = false;
            }
        }

        function askConfirm(callback) {
            deleteAction = callback;
            document.getElementById('confirmModal').classList.remove('hidden');
        }

        document.getElementById('confirmDelete').onclick = () => {
            if (deleteAction) deleteAction();
            document.getElementById('confirmModal').classList.add('hidden');
            deleteAction = null;
        };

        document.getElementById('cancelDelete').onclick = () => {
            document.getElementById('confirmModal').classList.add('hidden');
            deleteAction = null;
        };

        function initApp() {
            document.getElementById('displayCity').innerText = settings.city;
            document.getElementById('currentDate').innerText = new Date().toLocaleDateString('tr-TR', { day: '2-digit', month: 'long', year: 'numeric' }).toUpperCase();
            renderFilters();
            loadFeed(false);
            fetchCurrencies();
            initPresets();
            lucide.createIcons();
        }

        async function loadFeed(forceRefresh = false) {
            const grid = document.getElementById('newsGrid');
            // Pagination'ı da temizle
            document.getElementById('paginationContainer').innerHTML = '';

            if (feeds.length === 0) {
                grid.innerHTML = `<div class="flex flex-col items-center justify-center py-40 animate-in fade-in duration-700 text-center space-y-4"><p class="serif text-2xl font-medium italic opacity-20">Akış şu an sessiz...</p><button onclick="openAddModal()" class="text-[10px] font-bold uppercase tracking-[0.2em] border-b border-black pb-1 hover:opacity-50 transition-opacity">+ KAYNAK EKLE</button></div>`;
                return;
            }

            grid.innerHTML = '<div class="col-span-full py-20 text-center animate-pulse uppercase text-[10px] font-bold tracking-[0.3em]">Sinyaller Taranıyor...</div>';

            const isAllActive = feeds.every(f => !f.active);
            let finalItems = [];
            let sourceName = "";
            let feedImage = null;

            if (isAllActive) {
                // Mixed Feed
                const promises = feeds.map(f => {
                    let url = f.url;
                    if (!url.startsWith('http')) url = `https://www.youtube.com/feeds/videos.xml?channel_id=${url}`;
                    return fetchRSSData(url, forceRefresh).then(data => ({ ...data, feedName: f.name })).catch(() => null);
                });

                const results = await Promise.all(promises);
                results.forEach(res => {
                    if (res && res.items) {
                        const itemsWithSource = res.items.map(item => ({
                            ...item,
                            sourceName: res.feedName,
                            _fromCache: res._fromCache,
                            _timestamp: res._timestamp
                        }));
                        finalItems.push(...itemsWithSource);
                    }
                });
                finalItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
                sourceName = "Karışık Akış";
            } else {
                // Single Feed
                const activeFeed = feeds.find(f => f.active);
                try {
                    let url = activeFeed.url;
                    if (!url.startsWith('http')) url = `https://www.youtube.com/feeds/videos.xml?channel_id=${url}`;
                    const data = await fetchRSSData(url, forceRefresh);
                    finalItems = data.items.map(i => ({ ...i, _fromCache: data._fromCache, _timestamp: data._timestamp }));
                    sourceName = activeFeed.name;
                    feedImage = data.feed.image;
                } catch (e) {
                    grid.innerHTML = `<div class="col-span-full py-20 text-center text-red-700 uppercase text-[10px] font-bold tracking-widest flex flex-col gap-2"><span>Bağlantı Hatası</span><span class="text-[8px] text-gray-500">${e.message}</span></div>`;
                    return;
                }
            }

            currentItems = finalItems;
            renderCurrentPage(sourceName, feedImage);
        }

        function renderCurrentPage(sourceName, feedImage) {
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const itemsToShow = currentItems.slice(startIndex, endIndex);
            const totalPages = Math.ceil(currentItems.length / ITEMS_PER_PAGE);

            renderItems(itemsToShow, sourceName, feedImage, totalPages);
        }

        function renderItems(items, sourceName, feedImage, totalPages) {
            const grid = document.getElementById('newsGrid');
            const paginationContainer = document.getElementById('paginationContainer');

            grid.className = viewMode === 'list' ? "flex flex-col w-full flex-grow" : "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 flex-grow content-start";

            if (items.length === 0) {
                grid.innerHTML = '<div class="col-span-full py-20 text-center text-gray-400 uppercase text-[10px] font-bold tracking-widest">İçerik Bulunamadı</div>';
                paginationContainer.innerHTML = '';
                return;
            }

            let html = items.map(item => {
                const dateRaw = new Date(item.pubDate);
                const date = isNaN(dateRaw) ? "" : dateRaw.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });

                let img = item.thumbnail;

                // YouTube Fallback: Eğer resim yoksa ama link YouTube linkiyse, ID'den resim oluştur
                if (!img && item.link && (item.link.includes('youtube.com') || item.link.includes('youtu.be'))) {
                    try {
                        let videoId = "";
                        const url = item.link;
                        if (url.includes('v=')) {
                            videoId = url.split('v=')[1].split('&')[0];
                        } else if (url.includes('youtu.be/')) {
                            videoId = url.split('youtu.be/')[1].split('?')[0];
                        } else if (url.includes('/embed/')) {
                            videoId = url.split('/embed/')[1].split('?')[0];
                        }

                        if (videoId) img = `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;
                    } catch (e) { console.log('YouTube thumb error', e); }
                }

                if (!img && item.enclosure && item.enclosure.link) {
                    const link = item.enclosure.link.toLowerCase();
                    if (link.match(/\.(jpg|jpeg|png|gif|webp)/)) img = item.enclosure.link;
                }
                if (!img && feedImage) img = feedImage;

                const cleanDesc = (item.description || "").replace(/<[^>]*>/g, '').substring(0, 80);
                const itemSource = item.sourceName || sourceName;
                const sourceInitial = (itemSource || "?")[0];

                // Cache logic for badge
                let cacheBadge = "";
                if (item._fromCache) {
                    const diffMins = Math.floor((Date.now() - item._timestamp) / 60000);
                    cacheBadge = `<div class="cache-badge"><i data-lucide="clock" class="w-2 h-2"></i> ${diffMins}DK ÖNCE</div>`;
                }

                if (viewMode === 'list') {
                    return `
                        <div class="list-view-item group cursor-pointer" onclick="window.open('${item.link}', '_blank')">
                            <div class="flex-grow">
                                <div class="flex items-center gap-2 text-[7px] font-bold uppercase opacity-30">
                                    <span>${itemSource}</span> • <span>${date}</span>
                                    ${item._fromCache ? '<span class="text-orange-500 font-black" title="Önbellekten">(CACHED)</span>' : ''}
                                </div>
                                <h3 class="serif text-xs font-bold group-hover:underline">${item.title}</h3>
                            </div>
                            <i data-lucide="external-link" class="w-3 h-3 opacity-10 group-hover:opacity-100"></i>
                        </div>`;
                }

                // FIX: Use double quotes for HTML attributes inside the innerHTML string to avoid single quote conflict
                return `
                    <div class="archive-card group cursor-pointer" onclick="window.open('${item.link}', '_blank')">
                        ${cacheBadge}
                        ${img ? `<div class="h-32 overflow-hidden border-b border-black bg-white"><img src="${img}" class="w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-500" onerror="this.parentElement.innerHTML='<div class=&quot;h-full flex items-center justify-center&quot;><span class=&quot;placeholder-initial&quot;>${sourceInitial}</span></div>'"></div>`
                        : `<div class="h-32 img-placeholder border-b border-black"><span class="placeholder-initial">${sourceInitial}</span></div>`}
                        <div class="p-4 flex flex-col flex-grow">
                            <div class="flex justify-between items-center mb-3 text-[8px] font-black uppercase tracking-widest">
                                <span class="border border-black px-1 truncate max-w-[100px]">${itemSource}</span>
                                <span class="opacity-40">${date}</span>
                            </div>
                            <h3 class="serif text-sm font-bold leading-tight mb-2 group-hover:underline">${item.title}</h3>
                            <p class="text-[10px] text-gray-500 italic line-clamp-2">${cleanDesc}...</p>
                        </div>
                    </div>`;
            }).join('');

            // Pagination Logic Update: Moved to separate container
            let pagUI = '';
            if (totalPages > 1) {
                pagUI = `<div class="flex justify-center items-center gap-2 py-8 border-t border-black/5 w-full mt-8">
                    <button onclick="changePage(1)" ${currentPage === 1 ? 'disabled' : ''} class="p-2 border border-black/10 hover:bg-black hover:text-white disabled:opacity-20 transition-all"><i data-lucide="chevrons-left" class="w-3 h-3"></i></button>
                    <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} class="p-2 border border-black/10 hover:bg-black hover:text-white disabled:opacity-20 transition-all"><i data-lucide="chevron-left" class="w-3 h-3"></i></button>
                    <div class="flex items-center gap-1 mx-4 text-[10px] font-bold uppercase tracking-widest">`;

                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                        pagUI += `<button onclick="changePage(${i})" class="w-8 h-8 flex items-center justify-center border ${currentPage === i ? 'bg-black text-white border-black' : 'border-transparent hover:border-black/20'}">${i}</button>`;
                    } else if (i === currentPage - 2 || i === currentPage + 2) {
                        pagUI += `<span class="px-1">...</span>`;
                    }
                }

                pagUI += `</div>
                    <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} class="p-2 border border-black/10 hover:bg-black hover:text-white disabled:opacity-20 transition-all"><i data-lucide="chevron-right" class="w-3 h-3"></i></button>
                    <button onclick="changePage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''} class="p-2 border border-black/10 hover:bg-black hover:text-white disabled:opacity-20 transition-all"><i data-lucide="chevrons-right" class="w-3 h-3"></i></button>
                </div>`;
            }

            grid.innerHTML = html;
            paginationContainer.innerHTML = pagUI;
            lucide.createIcons();
        }

        window.changePage = (newPage) => {
            currentPage = newPage;
            const isAllActive = feeds.every(f => !f.active);
            const sourceName = isAllActive ? "Karışık Akış" : feeds.find(f => f.active).name;
            renderCurrentPage(sourceName, null);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        function renderFilters() {
            const nav = document.getElementById('feedFilters');
            const isAllActive = feeds.every(f => !f.active);
            nav.innerHTML = `<button onclick="switchFeed(-1)" class="feed-filter whitespace-nowrap ${isAllActive ? 'active' : ''}">Hepsi</button>` + feeds.map((f, i) => `
                <div class="group relative flex items-center gap-1.5">
                    <button onclick="switchFeed(${i})" class="feed-filter whitespace-nowrap ${f.active ? 'active' : ''}">${f.name}</button>
                    <button onclick="event.stopPropagation(); askConfirm(() => deleteFilter(${i}))" class="opacity-0 group-hover:opacity-40 hover:!opacity-100 transition-opacity p-0.5"><i data-lucide="x" class="w-2.5 h-2.5"></i></button>
                </div>`).join('');
            lucide.createIcons();
        }

        window.switchFeed = (idx) => {
            currentPage = 1;
            if (idx === -1) { feeds.forEach(f => f.active = false); }
            else { feeds.forEach((f, i) => f.active = i === idx); }
            localStorage.setItem(STORAGE_KEY, JSON.stringify(feeds));
            renderFilters();
            loadFeed(false);
        };

        window.deleteFilter = (idx) => {
            const wasActive = feeds[idx].active;
            // Clear cache for this url
            localStorage.removeItem(CACHE_PREFIX + btoa(feeds[idx].url));
            feeds.splice(idx, 1);
            if (wasActive && feeds.length > 0) feeds[0].active = true;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(feeds));
            renderFilters();
            loadFeed(false);
        };

        async function fetchCurrencies() {
            try {
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await res.json();
                document.getElementById('usdRate').innerText = `USD ${data.rates.TRY.toFixed(2)}`;
                document.getElementById('eurRate').innerText = `EUR ${(data.rates.TRY / data.rates.EUR).toFixed(2)}`;
            } catch (e) { }
        }

        document.getElementById('fetchUrlBtn').onclick = smartFetch;

        document.getElementById('saveFeed').onclick = () => {
            const name = document.getElementById('feedNameInput').value;
            let url = feedUrlInput.value.trim();
            const type = typeSelector.value;
            if (name && url) {
                if (type === 'youtube' && url.includes('channel/')) { url = url.split('channel/')[1].split('/')[0].split('?')[0]; }
                else if (type === 'auto' && !url.startsWith('http')) { url = 'https://' + url; }

                if (editingIndex > -1) { draftFeeds[editingIndex] = { ...draftFeeds[editingIndex], name, url, type }; }
                else { draftFeeds.push({ name, url, type, active: false }); }

                if (document.getElementById('manageModal').classList.contains('hidden')) {
                    feeds = JSON.parse(JSON.stringify(draftFeeds));
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(feeds));
                    initApp();
                } else { renderManageList(); }
                closeModalFunc();
            }
        };

        document.getElementById('manageFeedsBtn').onclick = () => {
            draftFeeds = JSON.parse(JSON.stringify(feeds));
            renderManageList();
            document.getElementById('cityInput').value = settings.city;
            document.getElementById('manageModal').classList.remove('hidden');
        };

        function renderManageList() {
            document.getElementById('manageListBody').innerHTML = draftFeeds.map((f, i) => `
                <div class="py-3 flex justify-between items-center group">
                    <div><div class="text-xs font-bold uppercase">${f.name}</div><div class="text-[8px] opacity-40 truncate max-w-[250px] uppercase">${f.url}</div></div>
                    <div class="flex gap-3">
                        <button onclick="editDraft(${i})" class="text-[8px] font-bold text-black hover:underline uppercase">Düzenle</button>
                        <button onclick="askConfirm(() => deleteDraft(${i}))" class="text-[8px] font-bold text-red-700 hover:underline uppercase">Sil</button>
                    </div>
                </div>`).join('');
        }

        window.deleteDraft = (i) => { draftFeeds.splice(i, 1); renderManageList(); };
        window.editDraft = (i) => {
            editingIndex = i;
            const item = draftFeeds[i];
            document.getElementById('modalTitle').innerText = "Kaynağı Düzenle";
            feedUrlInput.value = item.url;
            document.getElementById('feedNameInput').value = item.name;
            typeSelector.value = item.type || 'rss';
            typeSelector.onchange();
            document.getElementById('detectedInfo').classList.remove('hidden');
            document.getElementById('modal').classList.remove('hidden');
        };

        window.openAddModal = () => {
            draftFeeds = JSON.parse(JSON.stringify(feeds));
            editingIndex = -1;
            document.getElementById('modalTitle').innerText = "Yeni Kaynak";
            feedUrlInput.value = "";
            document.getElementById('feedNameInput').value = "";
            typeSelector.value = "rss";
            typeSelector.onchange();
            document.getElementById('urlStatusContainer').classList.add('hidden');
            document.getElementById('detectedInfo').classList.add('hidden');
            document.getElementById('modal').classList.remove('hidden');
        };

        function closeModalFunc() { document.getElementById('modal').classList.add('hidden'); editingIndex = -1; }
        document.getElementById('globalSaveBtn').onclick = () => {
            feeds = JSON.parse(JSON.stringify(draftFeeds));
            settings.city = document.getElementById('cityInput').value.toUpperCase();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(feeds));
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
            document.getElementById('manageModal').classList.add('hidden');
            initApp();
        };

        document.getElementById('addNewFeedFromSettings').onclick = openAddModal;
        document.getElementById('closeModal').onclick = closeModalFunc;
        document.getElementById('closeManageModal').onclick = () => document.getElementById('manageModal').classList.add('hidden');

        // Refresh Button now forces a network fetch (bypassing cache)
        document.getElementById('refreshBtn').onclick = () => {
            const icon = document.getElementById('refreshIcon');
            icon.classList.add('animate-spin');
            loadFeed(true).then(() => {
                setTimeout(() => icon.classList.remove('animate-spin'), 1000);
            });
        };

        document.getElementById('viewCardBtn').onclick = () => { viewMode = 'card'; localStorage.setItem('viewMode', 'card'); loadFeed(false); };
        document.getElementById('viewListBtn').onclick = () => { viewMode = 'list'; localStorage.setItem('viewMode', 'list'); loadFeed(false); };

        // --- Preset Selector Logic ---
        const presetSelector = document.getElementById('presetSelector');

        function initPresets() {
            if (!presetSelector) return;
            let html = '<option value="">Katalogdan Seç...</option>';
            RX_PRESETS.forEach(cat => {
                html += `<optgroup label="${cat.category}">`;
                cat.items.forEach(item => {
                    html += `<option value="${item.url}" data-name="${item.title}">${item.title}</option>`;
                });
                html += `</optgroup>`;
            });
            presetSelector.innerHTML = html;
        }

        if (presetSelector) {
            presetSelector.onchange = () => {
                const val = presetSelector.value;
                if (!val) return;

                const opt = presetSelector.options[presetSelector.selectedIndex];
                const name = opt.getAttribute('data-name');

                feedUrlInput.value = val;
                document.getElementById('feedNameInput').value = name;
                typeSelector.value = 'rss';
                typeSelector.onchange();

                // Auto trigger validation
                smartFetch();
            };
        }

        initApp();
    </script>
</body>

</html>